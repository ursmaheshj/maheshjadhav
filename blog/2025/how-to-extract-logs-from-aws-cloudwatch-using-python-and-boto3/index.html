<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <p>AWS is a popular cloud service that offers CloudWatch, a powerful tool for monitoring, storing, and accessing log files from various resources like EC2 instances, CloudTrail, ECS, and Route 53.</p> <p>Knowing how to extract these logs for analysis and examination is essential. In this blog, we will explore the same and get the data we need.</p> <figure><img alt="https://www.webiny.com/docs/messages/cloudwatch" src="https://cdn-images-1.medium.com/max/1024/1*AvEVVnAw-mLtIawURDpBIQ.png"><figcaption>AWS CloudWatch logs</figcaption></figure> <p><em>Lets consider we want to extract only the messages which starts with “</em>START RequestId:<em>” from last 7 days logs.</em></p> <ol><li>Install and import required libraries:</li></ol> <pre>import boto3 <br>from datetime import datetime, timedelta <br>import time</pre> <p>2. Create a client with ‘logs’:</p> <pre>client = boto3.client('logs')</pre> <p>3. Define log group and timeframe:</p> <pre>log_group_name = '/aws/lambda/wby-graphql-af86eaa'  # Replace with your log group name <br>end_time = int(datetime.now().timestamp() * 1000)  # Current time in milliseconds <br>start_time = int((datetime.now() - timedelta(days=7)).timestamp() * 1000)  # Time 7 days ago in milliseconds</pre> <p>4. Define the pattern to extract from logs:</p> <pre>filter_pattern = '"START RequestId:"'  # Replace with your filter pattern like "Response of API: {}"</pre> <p>5. Get paginator by providing required fields:</p> <pre>paginator = client.get_paginator('filter_log_events')</pre> <p>6. Create a response iterator using paginator</p> <pre>response_iterator = paginator.paginate(<br>    logGroupName=log_group_name,<br>    filterPattern=filter_pattern, <br>    startTime=start_time,<br>    endTime=end_time<br>)</pre> <p>7. Create a list of required messages by iterating over response iterator</p> <pre>logs = []<br>for response in response_iterator:<br>    for event in response['events']:<br>        message = event['message']<br>        logs.append(message)</pre> <h3>Full Code:</h3> <p>Below code contains full code on how to extract data from AWS CloudWatch service.</p> <pre>import time <br>import boto3<br>from datetime import datetime, timedelta<br><br># Initialize a session using Amazon CloudWatch<br>client = boto3.client('logs')<br><br># Define the log group name and the time range for which the logs are to be retrieved<br>log_group_name = '/aws/lambda/wby-graphql-af86eaa'  # Replace with your log group name<br>end_time = int(datetime.now().timestamp() * 1000)  # Current time in milliseconds<br>start_time = int((datetime.now() - timedelta(days=7)).timestamp() * 1000)  # Time 7 days ago in milliseconds<br><br># Function to get logs from CloudWatch<br>def get_logs(log_group_name, start_time, end_time):<br>    """<br>    Retrieves logs from the specified log group within the given time range.<br><br>    Parameters:<br>    log_group_name (str): The name of the log group.<br>    start_time (int): The start time in milliseconds.<br>    end_time (int): The end time in milliseconds.<br><br>    Returns:<br>    list: A list of log messages.<br>    """<br>    filter_pattern = '"START RequestId:"'  # Replace with your filter pattern<br>    paginator = client.get_paginator('filter_log_events')<br>    print(f"paginator: {paginator}")<br>    <br>    # Paginate through the log events<br>    response_iterator = paginator.paginate(<br>        logGroupName=log_group_name,<br>        filterPattern=filter_pattern, <br>        startTime=start_time,<br>        endTime=end_time<br>    )<br>    <br>    logs = []<br>    for response in response_iterator:<br>        for event in response['events']:<br>            message = event['message']<br>            logs.append(message)<br>    <br>    return logs<br><br>if __name__ == '__main__':<br>    # Measure the time taken to retrieve logs<br>    st = time.time()<br>    <br>    # Retrieve logs<br>    logs = get_logs(log_group_name, start_time, end_time)<br>    print(f"Logs: {logs}")<br>    <br>    # Calculate elapsed time<br>    et = time.time()<br>    elapsed_time = et - st<br>    print(f"Elapsed time: {elapsed_time} seconds")</pre> <p><img src="https://medium.com/_/stat?event=post.clientViewed&amp;referrerSource=full_rss&amp;postId=d4b3e03a5741" width="1" height="1" alt=""></p> </body></html>